{% extends "base.html" %}

{% block title %}System Reports - DevThoughts{% endblock %}

{% block content %}
<h2>System Reports</h2>

<!-- ================= Summary Stats Cards ================= -->
<!-- ================= Summary Stats Cards ================= -->
<div class="row mb-4">

    <!-- Total Blogs -->
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card shadow-sm border-0 p-3 text-center">
            <h6 class="text-muted">Total Blogs</h6>
            <h3 class="fw-bold">{{ total_blogs }}</h3>
        </div>
    </div>

    <!-- Blogs This Month -->
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card shadow-sm border-0 p-3 text-center">
            <h6 class="text-muted">Blogs This Month</h6>
            <h3 class="fw-bold text-primary">{{ blogs_this_month }}</h3>
        </div>
    </div>

    <!-- Total Users -->
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card shadow-sm border-0 p-3 text-center">
            <h6 class="text-muted">Total Users</h6>
            <h3 class="fw-bold text-success">{{ total_users }}</h3>
        </div>
    </div>

    <!-- Active Users -->
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card shadow-sm border-0 p-3 text-center">
            <h6 class="text-muted">Active Users</h6>
            <h3 class="fw-bold text-success">{{ active_users }}</h3>
        </div>
    </div>

    <!-- Inactive Users -->
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card shadow-sm border-0 p-3 text-center">
            <h6 class="text-muted">Inactive Users</h6>
            <h3 class="fw-bold text-danger">{{ inactive_users }}</h3>
        </div>
    </div>

    <!-- Managers -->
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card shadow-sm border-0 p-3 text-center">
            <h6 class="text-muted">Managers</h6>
            <h3 class="fw-bold">{{ total_managers }}</h3>
        </div>
    </div>

    <!-- Editors -->
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card shadow-sm border-0 p-3 text-center">
            <h6 class="text-muted">Editors</h6>
            <h3 class="fw-bold">{{ total_editors }}</h3>
        </div>
    </div>

    <!-- Authors -->
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card shadow-sm border-0 p-3 text-center">
            <h6 class="text-muted">Authors</h6>
            <h3 class="fw-bold">{{ total_authors }}</h3>
        </div>
    </div>

    <!-- Most Active Author -->
    <div class="col-md-6 col-sm-12 mb-3">
        <div class="card shadow-sm border-0 p-3 text-center">
            <h6 class="text-muted">Most Active Author</h6>
            <h5 class="fw-bold">
                {% if most_active_author %}
                    {{ most_active_author.author__username }}
                    ({{ most_active_author.post_count }} posts)
                {% else %}
                    No data available
                {% endif %}
            </h5>
        </div>
    </div>

</div>

<!-- ================= Charts Section ================= -->

<!-- Blogs per Category (Bar Chart) -->
<div class="mb-4">
    <h4>Blogs per Category</h4>
    <!-- Canvas element for Chart.js -->
    <canvas id="categoryChart" style="max-height:300px;"></canvas>
</div>

<!-- User Role Distribution (Pie Chart) -->
<div class="mb-4">
    <h4>User Role Distribution</h4>
    <canvas id="roleChart" style="max-height:450px;"></canvas>
</div>

<!-- Monthly Blog Growth (Line Chart) -->
<div class="mb-4">
    <h4>Monthly Blog Growth</h4>
    <canvas id="monthlyChart" style="max-height:300px;"></canvas>
</div>

<div class="mb-4">
    <h4>Active vs Inactive Users</h4>
    <canvas id="activeUsersChart" style="max-height:300px;"></canvas>
</div>

<div class="mb-4">
    <h4>Monthly User Growth</h4>
    <canvas id="userGrowthChart" style="max-height:300px;"></canvas>
</div>

<!-- ================= Chart.js Library ================= -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    /* ---------------- Bar Chart: Blogs per Category ---------------- */
    const categoryCtx = document.getElementById('categoryChart').getContext('2d');
    new Chart(categoryCtx, {
        type: 'bar',
        data: {
            labels: {{ category_labels|safe }},      // Categories from view
            datasets: [{
                label: 'Blogs per Category',
                data: {{ category_counts|safe }},   // Number of blogs in each category
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,                     // Make chart responsive
            maintainAspectRatio: false,           // Allow max-height style to work
            plugins: { legend: { display: false } },  // Hide legend for clean look
            scales: {
                y: { beginAtZero: true }         // Start y-axis from 0
            }
        }
    });

    /* ---------------- Pie Chart: User Role Distribution ---------------- */
    const roleCtx = document.getElementById('roleChart').getContext('2d');
    new Chart(roleCtx, {
        type: 'pie',
        data: {
            labels: {{ role_labels|safe }},       // Roles like Manager, Editor, Author
            datasets: [{
                data: {{ role_data|safe }},       // Number of users per role
                backgroundColor: ['#FF6384','#36A2EB','#FFCE56'] // Color per role
            }]
        },
        options: {
            responsive: true
        }
    });

    /* ---------------- Line Chart: Monthly Blog Growth ---------------- */
    const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
    new Chart(monthlyCtx, {
        type: 'line',
        data: {
            labels: {{ monthly_labels|safe }},    // Months
            datasets: [{
                label: 'Blogs Created',
                data: {{ monthly_data|safe }},   // Count per month
                fill: false,
                borderColor: 'rgba(75, 192, 192, 1)',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });

    /* ---------------- Bar Chart: Active vs Inactive Users ---------------- */
    const activeCtx = document.getElementById('activeUsersChart').getContext('2d');
    new Chart(activeCtx, {
        type: 'bar',
        data: {
            labels: ['Active', 'Inactive'],
            datasets: [{
                label: 'User Status',
                data: [{{ active_users }}, {{ inactive_users }}],
                backgroundColor: ['#4CAF50', '#F44336']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });

    /* ---------------- Line Chart: Monthly User Growth ---------------- */
    const userGrowthCtx = document.getElementById('userGrowthChart').getContext('2d');
    new Chart(userGrowthCtx, {
        type: 'line',
        data: {
            labels: {{ user_month_labels|safe }},
            datasets: [{
                label: 'Users Joined',
                data: {{ user_month_data|safe }},
                borderColor: 'rgba(153, 102, 255, 1)',
                fill: false,
                tension: 0.2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
</script>
{% endblock %}